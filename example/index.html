<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Slazy Demo</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <style>
      body {
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        margin: 0;
        background: #f4f5f7;
      }

      header {
        background: #1f2933;
        color: #fff;
        padding: 2rem 1.5rem;
        text-align: center;
      }

      main {
        padding: 2rem 1.5rem 4rem;
        max-width: 960px;
        margin: 0 auto;
      }

      section {
        margin-bottom: 2.5rem;
        background: #fff;
        border-radius: 8px;
        box-shadow: 0 10px 30px rgba(15, 23, 42, 0.08);
        overflow: hidden;
      }

      section h2 {
        margin: 0;
        padding: 1rem 1.5rem 0;
      }

      section p {
        padding: 0 1.5rem 1.5rem;
        margin: 0;
      }

      .image-wrapper {
        position: relative;
      }

      .image-wrapper img {
        display: block;
        width: 100%;
        height: auto;
      }

      /* BlurHash placeholder overlay to show decoded canvas before the image upgrades. */
      .blurhash-wrapper {
        position: relative;
        background: #111827;
        border-radius: 8px;
      }

      .blurhash-wrapper canvas {
        position: absolute;
        inset: 0;
        width: 100%;
        height: 100%;
        border-radius: inherit;
        pointer-events: none;
        transition: opacity 0.35s ease;
        z-index: 0;
      }

      .blurhash-wrapper img {
        position: relative;
        z-index: 1;
      }

      .blurhash-hidden {
        opacity: 0;
      }

      .feature-card {
        min-height: 280px;
        display: grid;
        place-items: center;
        color: #fff;
        font-size: 1.5rem;
        font-weight: 600;
        text-align: center;
      }

      .gallery-grid {
        display: grid;
        gap: 1.5rem;
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
        padding: 0 1.5rem 1.5rem;
      }

      .gallery-card {
        background: #fff;
        border-radius: 8px;
        box-shadow: 0 6px 20px rgba(15, 23, 42, 0.06);
        overflow: hidden;
      }

      .gallery-card img {
        display: block;
        width: 100%;
        height: auto;
      }

      .gallery-card figcaption {
        padding: 1rem;
        font-weight: 500;
      }

      footer {
        text-align: center;
        padding: 1.5rem;
        color: #6b7280;
      }
    </style>
  </head>
  <body>
    <header>
      <h1>Slazy Example Page</h1>
      <p>Scroll to see images and backgrounds upgrade themselves when they enter the viewport.</p>
    </header>
    <main>
      <section>
        <h2>Lazy &lt;img&gt; example</h2>
        <p>
          The hero image starts with a lightweight placeholder and is replaced with a full-size
          version once Slazy detects it in view.
        </p>
        <div class="image-wrapper">
          <img
            src="https://cdn.jsdelivr.net/gh/lesichkovm/slazy@latest/dist/1x1.png"
            data-slazy-src="https://images.unsplash.com/photo-1500530855697-b586d89ba3ee?auto=format&fit=crop&w=1600&h=900&q=80"
            alt="Lazy loaded hero"
          />
        </div>
      </section>

      <section>
        <h2>BlurHash placeholder example</h2>
        <p>
          Combine Slazy with <a href="https://blurha.sh/" target="_blank" rel="noreferrer">BlurHash</a>
          to paint a smooth, decoded placeholder on a canvas while the real image is loading. The canvas
          fades away once Slazy swaps in the full-resolution asset.
        </p>
        <div class="image-wrapper blurhash-wrapper">
          <canvas
            class="blurhash-canvas"
            data-blurhash="LEHV6nWB2yk8pyo0adR*.7kCMdnj"
            width="32"
            height="32"
            aria-hidden="true"
          ></canvas>
          <img
            src="https://cdn.jsdelivr.net/gh/lesichkovm/slazy@latest/dist/1x1.png"
            data-slazy-src="https://images.unsplash.com/photo-1500530855697-b586d89ba3ee?auto=format&fit=crop&w=1600&h=900&q=80"
            alt="BlurHash placeholder swapping to a mountain landscape"
          />
        </div>
      </section>

      <section>
        <h2>Lazy background example</h2>
        <p>
          Any element can swap its background image. Slazy will resize the URL based on the element width
          to avoid pulling unnecessarily large assets.
        </p>
        <div
          class="feature-card"
          style="background-image: url('https://cdn.jsdelivr.net/gh/lesichkovm/slazy@latest/dist/1x1.png');"
          data-slazy-url="https://images.unsplash.com/photo-1489515217757-5fd1be406fef?auto=format&fit=crop&w=1600&h=900&q=80"
        >
          Loaded on demand
        </div>
      </section>

      <section>
        <h2>"No Resize" modifier</h2>
        <p>
          Add the <code>no-resize</code> class when you want to load the original asset without the automatic
          width substitution. The first card below is resized to match its width, while the second keeps the
          original URL untouched.
        </p>
        <div class="gallery-grid">
          <figure class="gallery-card">
            <img
              src="https://cdn.jsdelivr.net/gh/lesichkovm/slazy@latest/dist/1x1.png"
              data-slazy-src="https://images.unsplash.com/photo-1545239351-1141bd82e8a6?auto=format&fit=crop&w=1600&h=1000&q=80"
              alt="Mountain field"
            />
            <figcaption>Default behaviour: resizes to the element width.</figcaption>
          </figure>
          <figure class="gallery-card">
            <img
              class="no-resize"
              src="https://cdn.jsdelivr.net/gh/lesichkovm/slazy@latest/dist/1x1.png"
              data-slazy-src="https://images.unsplash.com/photo-1501785888041-af3ef285b470?auto=format&fit=crop&w=1600&h=1000&q=80"
              alt="Snowy mountains"
            />
            <figcaption><code>no-resize</code>: keeps the original source dimensions.</figcaption>
          </figure>
        </div>
        <div
          class="feature-card no-resize"
          style="background-image: url('https://cdn.jsdelivr.net/gh/lesichkovm/slazy@latest/dist/1x1.png');"
          data-slazy-url="https://images.unsplash.com/photo-1500530855697-b586d89ba3ee?auto=format&fit=crop&w=1600&h=900&q=80"
        >
          Background with <code>no-resize</code>
        </div>
      </section>

      <section>
        <h2>Gallery of lazy-loaded images</h2>
        <p>
          Each photo starts with a small Unsplash preview and swaps to a high-resolution version as soon as it
          scrolls into view.
        </p>
        <div class="gallery-grid">
          <figure class="gallery-card">
            <img
              src="https://cdn.jsdelivr.net/gh/lesichkovm/slazy@latest/dist/1x1.png"
              data-slazy-src="https://images.unsplash.com/photo-1470770841072-f978cf4d019e?auto=format&fit=crop&w=1600&h=1000&q=80"
              alt="Misty forest trail"
            />
            <figcaption>Morning fog over the pines</figcaption>
          </figure>
          <figure class="gallery-card">
            <img
              src="https://cdn.jsdelivr.net/gh/lesichkovm/slazy@latest/dist/1x1.png"
              data-slazy-src="https://images.unsplash.com/photo-1467269204594-9661b134dd2b?auto=format&fit=crop&w=1600&h=1000&q=80"
              alt="City skyline at dusk"
            />
            <figcaption>City lights at golden hour</figcaption>
          </figure>
          <figure class="gallery-card">
            <img
              src="https://cdn.jsdelivr.net/gh/lesichkovm/slazy@latest/dist/1x1.png"
              data-slazy-src="https://images.unsplash.com/photo-1507525428034-b723cf961d3e?auto=format&fit=crop&w=1600&h=1000&q=80"
              alt="Ocean waves at sunset"
            />
            <figcaption>Waves meeting the sunset</figcaption>
          </figure>
        </div>
      </section>

      <section>
        <h2>Bootstrap carousel integration</h2>
        <p>
          Slazy plays nicely with existing carousels. The example below uses the Bootstrap 5 carousel and
          lazy loads each slide as it becomes active.
        </p>
        <div id="carouselExample" class="carousel slide">
          <div class="carousel-inner">
            <div class="carousel-item active">
              <img
                class="d-block w-100"
                src="https://cdn.jsdelivr.net/gh/lesichkovm/slazy@latest/dist/1x1.png"
                data-slazy-src="https://images.unsplash.com/photo-1500530855697-b586d89ba3ee?auto=format&fit=crop&w=1600&h=900&q=80"
                alt="Carousel landscape"
              />
            </div>
            <div class="carousel-item">
              <img
                class="d-block w-100"
                src="https://cdn.jsdelivr.net/gh/lesichkovm/slazy@latest/dist/1x1.png"
                data-slazy-src="https://images.unsplash.com/photo-1467269204594-9661b134dd2b?auto=format&fit=crop&w=1600&h=1000&q=80"
                alt="Carousel city"
              />
            </div>
            <div class="carousel-item">
              <img
                class="d-block w-100"
                src="https://cdn.jsdelivr.net/gh/lesichkovm/slazy@latest/dist/1x1.png"
                data-slazy-src="https://images.unsplash.com/photo-1507525428034-b723cf961d3e?auto=format&fit=crop&w=1600&h=1000&q=80"
                alt="Carousel ocean"
              />
            </div>
          </div>
          <button class="carousel-control-prev" type="button" data-bs-target="#carouselExample" data-bs-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Previous</span>
          </button>
          <button class="carousel-control-next" type="button" data-bs-target="#carouselExample" data-bs-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Next</span>
          </button>
        </div>
      </section>
    </main>

    <footer>
      <small>
        Open the browser console to watch Slazy update attributes as you scroll. Photos by Unsplash
        creators.
      </small>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/blurhash@1.1.4/dist/blurhash.min.js"></script>
    <script>
      // Decode BlurHash strings into canvases so visitors see a soft preview before Slazy promotes the full image.
      document.addEventListener("DOMContentLoaded", function () {
        const blurhashApi = typeof blurhash === "object" ? blurhash : null;

        if (!blurhashApi || typeof blurhashApi.decode !== "function") {
          return;
        }

        document.querySelectorAll("canvas[data-blurhash]").forEach(function (canvas) {
          const hash = canvas.dataset.blurhash;

          if (!hash) {
            return;
          }

          const width = Number(canvas.getAttribute("width")) || 32;
          const height = Number(canvas.getAttribute("height")) || 32;
          const context = canvas.getContext("2d");

          if (!context) {
            return;
          }

          // Ensure the canvas internal bitmap matches the decode dimensions for crisp scaling.
          canvas.width = width;
          canvas.height = height;

          // Decode the BlurHash string into raw RGBA pixels and paint them onto the canvas.
          const pixels = blurhashApi.decode(hash, width, height);
          const imageData = context.createImageData(width, height);
          imageData.data.set(pixels);
          context.putImageData(imageData, 0, 0);

          const parent = canvas.closest(".blurhash-wrapper");
          const targetImage = parent ? parent.querySelector("img[data-slazy-src]") : null;

          if (!targetImage) {
            return;
          }

          // Fade the canvas placeholder away once the high-resolution asset is ready.
          const hidePlaceholder = function () {
            canvas.classList.add("blurhash-hidden");
          };

          if (targetImage.complete && targetImage.naturalWidth > 0) {
            hidePlaceholder();
            return;
          }

          targetImage.addEventListener("load", hidePlaceholder, { once: true });
        });
      });
    </script>
    <script src="../slazy.js"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
